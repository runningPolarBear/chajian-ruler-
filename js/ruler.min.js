function Ruler(c,a){var b=this;this.clientWidth=document.body.clientWidth;this.maxNum=a.maxNum||300;this.minNum=a.minNum||30;this.cellNum=a.cellNum||10;this.minNum=parseInt(this.minNum/this.cellNum)*this.cellNum;this.record=[];if((this.maxNum-this.minNum)%this.cellNum!=0){this.maxNum=this.minNum+this.cellNum*parseInt((this.maxNum-this.minNum)/this.cellNum+1)}this.name=a.name;this.unit=a.unit;this.initNum=a.initNum;this.nowData=this.initNum||this.minNum||30;this.decimalWei=a.decimalWei;this.rulerStructure(c);this.drawRuler();this.moveRuler()}Ruler.prototype.rulerStructure=function(b){var e=document.getElementById(b);var f={"background":"#fff","overflow":"hidden","position":"relative"};this.addStyle(e,f);var c=document.createElement("div");c.setAttribute("class","ruler-title");titleStyle={"width":"100%","height":"40%","background":"orange","position":"relative","color":"#fff"};this.addStyle(c,titleStyle);var a=document.createElement("div");a.setAttribute("class","ruler-title");a.setAttribute("id","rulerTitle");nameStyle={"padding":"6px"};this.addStyle(a,nameStyle);a.innerHTML=this.name||"心率";var i=document.createElement("div");i.setAttribute("class","ruler-parameter");parameterStyle={"position":"absolute","width":"100%","left":"0","top":"0","text-align":"center","box-sizing":"border-box","margin-top":"10px"};this.addStyle(i,parameterStyle);i.innerHTML="<span id='ruler-num' style='font: bold 48px/48px 微软雅黑;'>30.0</span><span id='ruler-unit'>bpm</span>";this.numNode=i.firstChild;i.firstChild.innerHTML=this.initNum||this.minNum;i.lastChild.innerHTML=this.unit;var g=document.createElement("div");g.setAttribute("class","ruler-intro");introStyle={"position":"absolute","width":"100%","left":"0","bottom":"4px","text-align":"center"};this.addStyle(g,introStyle);g.innerHTML="滑动标尺，设置测量数据";c.appendChild(a);c.appendChild(i);c.appendChild(g);e.appendChild(c);var d=document.createElement("div");d.setAttribute("class","ruler-contain");containStyle={"width":"100%","height":"40%","background":"#999","position":"absolute","top":"50%","left":"0"};this.addStyle(d,containStyle);d.innerHTML="<div class='ruler' id='ruler' style='left: 0; height: 100%; position: absolute; background: #fff; top: 0; left: 0;'><canvas id='rulerCanvas'></canvas></div>";d.firstChild.style.left=-(this.initNum-this.minNum)/this.cellNum*100+"px";d.firstChild.firstChild.width=(Math.ceil((this.maxNum-this.minNum)/this.cellNum)*100+this.clientWidth*0.9);d.firstChild.firstChild.height="80";this.Canvas=d.firstChild.firstChild.getContext("2d");this.rulerNode=d.firstChild;e.appendChild(d);var h=document.createElement("div");h.setAttribute("class","ruler-img");pinStyle={"margin":"0 auto","margin-top":"10px","width":"16px","height":"106px","position":"relative","z-index":"999"};this.addStyle(h,pinStyle);h.innerHTML="<canvas id='pinPic' width='16' height='106' style='opacity:0.8;'></canvas>";this.drawPin(h.firstChild);e.appendChild(h)};Ruler.prototype.addStyle=function(c,b){for(var a in b){c.style[a]=b[a]}};Ruler.prototype.drawPin=function(a){var b=a.getContext("2d");b.beginPath();b.moveTo(15,90);b.arc(8,90,7,0,Math.PI*2,false);b.fillStyle="#f00";b.fill();b.closePath();b.beginPath();b.moveTo(12,90);b.lineTo(8,10);b.lineTo(4,90);b.lineTo(12,90);b.fillStyle="#f00";b.fill();b.closePath()};Ruler.prototype.drawRuler=function(){var a=this;(function(){for(var b=0;b<=Math.ceil((a.maxNum-a.minNum)/a.cellNum);b++){c(b)}function c(d){a.Canvas.beginPath();a.Canvas.moveTo(a.clientWidth*0.9/2+100*d,0);a.Canvas.lineTo(a.clientWidth*0.9/2+100*d,50);a.Canvas.stroke();a.Canvas.closePath();a.Canvas.font="16px 宋体";a.Canvas.strokeText(a.decimal(a.minNum+a.cellNum*d,a.decimalWei),a.clientWidth*0.9/2+100*d-8,66)}})();(function(){for(var b=0;b<=Math.ceil((a.maxNum-a.minNum)/a.cellNum)*100/10;b++){if(b%10!=0){c(b)}}function c(d){a.Canvas.beginPath();a.Canvas.moveTo(a.clientWidth*0.9/2+10*d,0);a.Canvas.lineTo(a.clientWidth*0.9/2+10*d,30);a.Canvas.stroke();a.Canvas.closePath()}})()};Ruler.prototype.moveRuler=function(){var a=this;this.rulerNode.addEventListener("touchstart",b,false);function b(h){var h=h||window.event;h.preventDefault();clearInterval(a.timer);a.record=[];var d=h.targetTouches[0].clientX;var c=h.targetTouches[0].clientY;a.rulerNode.addEventListener("touchmove",g,false);var i=parseInt(a.rulerNode.style.left);var j=0;function g(r){var r=r||window.event;var n=r.targetTouches[0].clientX;var m=r.targetTouches[0].clientY;var l=n-d;var k=m-c;isScrolling=Math.abs(l)<Math.abs(k)?1:0;if(isScrolling==1){r.preventDefault()}else{var q=-Math.round(i+l)/(100/a.cellNum)+a.minNum;var p=i+l;if(p>=0){p=0;q=a.minNum}else{if(p<=-(Math.ceil((a.maxNum-a.minNum)/a.cellNum)*100)){p=-(Math.ceil((a.maxNum-a.minNum)/a.cellNum)*100);q=a.maxNum}}a.nowData=a.decimal(q,a.decimalWei);a.numNode.innerHTML=a.nowData;a.rulerNode.style.left=p+"px";j++;var o=new Date().getTime();a.record[j]=[];a.record[j].push(o);a.record[j].push(p)}}a.rulerNode.addEventListener("touchend",f,false);function f(n){var n=n||window.event;
a.rulerNode.removeEventListener("touchmove",g);a.rulerNode.removeEventListener("touchend",f);if(a.record.length>3){var m=(a.record[a.record.length-1][1]-a.record[a.record.length-4][1])/(a.record[a.record.length-1][0]-a.record[a.record.length-4][0])*1000;clearInterval(a.timer);a.timer=setInterval(function(){if(Math.abs(m)>100){m=m>0?m-30:m+30;var q=parseInt(a.rulerNode.style.left)+(m/50);if(q>=0){q=0}else{if(q<=-(Math.ceil((a.maxNum-a.minNum)/a.cellNum)*100)){q=-(Math.ceil((a.maxNum-a.minNum)/a.cellNum)*100)}}a.rulerNode.style.left=q+"px";var p=-Math.round(q)/(100/a.cellNum)+a.minNum;a.nowData=a.decimal(p,a.decimalWei);a.numNode.innerHTML=a.nowData}else{clearInterval(a.timer);var e=parseFloat(a.rulerNode.style.left);var o=parseInt(e/10);if(e-o*10>-5){a.movePart(e,o*10,10,a.rulerNode,"left")}else{a.movePart(e,(o-1)*10,10,a.rulerNode,"left")}}},20)}else{var k=parseFloat(a.rulerNode.style.left);var l=parseInt(k/10);if(k-l*10>-5){a.movePart(k,l*10,10,a.rulerNode,"left")}else{a.movePart(k,(l-1)*10,10,a.rulerNode,"left")}}}}};Ruler.prototype.movePart=function(a,d,g,e,h,i){var f=this;clearInterval(c);if(d!=a){var b=(d-a)/g;var c=setInterval(function(){a+=b;if(a<=d&&b<0){clearInterval(c);a=d;if(i){i()}}else{if(a>=d&&b>0){clearInterval(c);a=d;if(i){i()}}}e.style[h]=a+"px";var j=-Math.round(a)/(100/f.cellNum)+f.minNum;f.nowData=f.decimal(j,f.decimalWei);f.numNode.innerHTML=f.nowData},20)}};Ruler.prototype.decimal=function(c,d){var a=c.toString().split(".");if(d==1){if(a.length==1){c=c.toString()+".0";return c}if(a.length>1){if(a[1].substring(0,d)=="0"){c=Math.round(c).toString()+".0";return c}else{c=Math.round(c*10)/10;var b=c.toString().split(".");if(b.length==1){c=c+".0"}return c}}}else{if(d==2){if(a.length==1){c=c.toString()+".00";return c}if(a.length>1){if(a[1].substring(0,d)=="0"){c=Math.round(c).toString()+".0";return c}else{c=Math.round(c*100)/100;var b=c.toString().split(".");if(b.length==1){c=c+".00"}return c}}}else{return Math.round(c)}}};